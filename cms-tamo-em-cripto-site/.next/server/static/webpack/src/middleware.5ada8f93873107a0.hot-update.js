"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/lib/actions/session.ts":
/*!************************************!*\
  !*** ./src/lib/actions/session.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createSession: () => (/* binding */ createSession),\n/* harmony export */   decrypt: () => (/* binding */ decrypt),\n/* harmony export */   deleteSession: () => (/* binding */ deleteSession),\n/* harmony export */   encrypt: () => (/* binding */ encrypt),\n/* harmony export */   getSession: () => (/* binding */ getSession)\n/* harmony export */ });\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! server-only */ \"(middleware)/./node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/next/dist/esm/api/headers.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/index.js\");\n\n\n\n//import { cache } from 'react'\n//import { jwtDecode } from \"jwt-decode\"\n//import { redirect } from \"next/navigation\"\nconst secretKey = process.env.NEXT_SESSION_SECRET;\nconst encodedKey = new TextEncoder().encode(secretKey);\nasync function encrypt(payload) {\n    return await new jose__WEBPACK_IMPORTED_MODULE_2__.SignJWT(payload).setProtectedHeader({\n        alg: \"HS256\"\n    }).setIssuedAt().setExpirationTime(\"7d\") // \"10 sec from now\"\n    .sign(encodedKey);\n}\nasync function decrypt(session = \"\") {\n    try {\n        const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_2__.jwtVerify)(session, encodedKey, {\n            algorithms: [\n                \"HS256\"\n            ]\n        });\n        return payload;\n    } catch (error) {\n        console.log(\"Failed to verify session\");\n    }\n}\nasync function createSession(token) {\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n    const session = await encrypt({\n        token,\n        expiresAt\n    }) // JSON.stringify(token)\n    ;\n    (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)().set(\"session\", session, {\n        expires: expiresAt,\n        maxAge: 60 * 60 * 24 * 7,\n        path: \"/\",\n        domain: process.env.HOST ?? \"localhost\",\n        httpOnly: true,\n        secure: true,\n        sameSite: \"lax\"\n    });\n}\nasync function getSession() {\n    //const cookie = request.cookies.get(\"session\")?.value\n    const cookie = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)().get(\"session\")?.value;\n    if (!cookie) return null;\n    const session = await decrypt(cookie);\n    if (!session) return null;\n    return session;\n}\nfunction deleteSession() {\n    //cookies().set(\"session\", \"\", { ...config, maxAge: 0, expires: new Date(0) });\n    (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)().delete(\"session\");\n} // export async function verifySession() {  // export const verifySession = cache(async () => {\n //   const session = await getSession()\n //   if (!session || !session?.token) return null // redirect('/login')\n //   return { isAuth: true, token: session.token }\n // } //})\n // export async function getUserSession() { //export const getUserSession = cache(async () => {\n //   const session = await verifySession()\n //   if (!session || !session?.token) return null\n //   const token = session?.token\n //   return jwtDecode(token)\n // } //})\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2xpYi9hY3Rpb25zL3Nlc3Npb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQW9CO0FBRWtCO0FBQ0c7QUFDekMsK0JBQStCO0FBQy9CLHdDQUF3QztBQUN4Qyw0Q0FBNEM7QUFFNUMsTUFBTUcsWUFBWUMsUUFBUUMsR0FBRyxDQUFDQyxtQkFBbUI7QUFDakQsTUFBTUMsYUFBYSxJQUFJQyxjQUFjQyxNQUFNLENBQUNOO0FBRXJDLGVBQWVPLFFBQVFDLE9BQVk7SUFDeEMsT0FBTyxNQUFNLElBQUlWLHlDQUFPQSxDQUFDVSxTQUN0QkMsa0JBQWtCLENBQUM7UUFBRUMsS0FBSztJQUFRLEdBQ2xDQyxXQUFXLEdBQ1hDLGlCQUFpQixDQUFDLE1BQU0sb0JBQW9CO0tBQzVDQyxJQUFJLENBQUNUO0FBQ1Y7QUFFTyxlQUFlVSxRQUFRQyxVQUE4QixFQUFFO0lBQzVELElBQUk7UUFDRixNQUFNLEVBQUVQLE9BQU8sRUFBRSxHQUFHLE1BQU1ULCtDQUFTQSxDQUFDZ0IsU0FBU1gsWUFBWTtZQUFFWSxZQUFZO2dCQUFDO2FBQVE7UUFBQztRQUNqRixPQUFPUjtJQUNULEVBQUUsT0FBT1MsT0FBTztRQUNkQyxRQUFRQyxHQUFHLENBQUM7SUFDZDtBQUNGO0FBRU8sZUFBZUMsY0FBY0MsS0FBYTtJQUMvQyxNQUFNQyxZQUFZLElBQUlDLEtBQUtBLEtBQUtDLEdBQUcsS0FBSyxJQUFJLEtBQUssS0FBSyxLQUFLO0lBQzNELE1BQU1ULFVBQVUsTUFBTVIsUUFBUTtRQUFFYztRQUFPQztJQUFVLEdBQUcsd0JBQXdCOztJQUU1RXpCLHFEQUFPQSxHQUFHNEIsR0FBRyxDQUFDLFdBQVdWLFNBQVM7UUFDaENXLFNBQVNKO1FBQ1RLLFFBQVEsS0FBSyxLQUFLLEtBQUs7UUFDdkJDLE1BQU07UUFDTkMsUUFBUTVCLFFBQVFDLEdBQUcsQ0FBQzRCLElBQUksSUFBSTtRQUM1QkMsVUFBVTtRQUNWQyxRQUFRO1FBQ1JDLFVBQVU7SUFDWjtBQUNGO0FBRU8sZUFBZUM7SUFDcEIsc0RBQXNEO0lBQ3RELE1BQU1DLFNBQVN0QyxxREFBT0EsR0FBR3VDLEdBQUcsQ0FBQyxZQUFZQztJQUN6QyxJQUFJLENBQUNGLFFBQVEsT0FBTztJQUVwQixNQUFNcEIsVUFBVSxNQUFNRCxRQUFRcUI7SUFDOUIsSUFBSSxDQUFDcEIsU0FBUyxPQUFPO0lBRXJCLE9BQU9BO0FBQ1Q7QUFFTyxTQUFTdUI7SUFDZCwrRUFBK0U7SUFDL0V6QyxxREFBT0EsR0FBRzBDLE1BQU0sQ0FBQztBQUNuQixFQUVBLCtGQUErRjtDQUMvRix1Q0FBdUM7Q0FDdkMsdUVBQXVFO0NBRXZFLGtEQUFrRDtDQUNsRCxTQUFTO0NBRVQsK0ZBQStGO0NBQy9GLDBDQUEwQztDQUMxQyxpREFBaUQ7Q0FFakQsaUNBQWlDO0NBQ2pDLDRCQUE0QjtDQUM1QixTQUFTIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9saWIvYWN0aW9ucy9zZXNzaW9uLnRzPzEwYTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdzZXJ2ZXItb25seSdcclxuXHJcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tICduZXh0L2hlYWRlcnMnXHJcbmltcG9ydCB7IFNpZ25KV1QsIGp3dFZlcmlmeSB9IGZyb20gJ2pvc2UnXHJcbi8vaW1wb3J0IHsgY2FjaGUgfSBmcm9tICdyZWFjdCdcclxuLy9pbXBvcnQgeyBqd3REZWNvZGUgfSBmcm9tIFwiand0LWRlY29kZVwiXHJcbi8vaW1wb3J0IHsgcmVkaXJlY3QgfSBmcm9tIFwibmV4dC9uYXZpZ2F0aW9uXCJcclxuXHJcbmNvbnN0IHNlY3JldEtleSA9IHByb2Nlc3MuZW52Lk5FWFRfU0VTU0lPTl9TRUNSRVRcclxuY29uc3QgZW5jb2RlZEtleSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzZWNyZXRLZXkpXHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5jcnlwdChwYXlsb2FkOiBhbnkpIHtcclxuICByZXR1cm4gYXdhaXQgbmV3IFNpZ25KV1QocGF5bG9hZClcclxuICAgIC5zZXRQcm90ZWN0ZWRIZWFkZXIoeyBhbGc6ICdIUzI1NicgfSlcclxuICAgIC5zZXRJc3N1ZWRBdCgpXHJcbiAgICAuc2V0RXhwaXJhdGlvblRpbWUoJzdkJykgLy8gXCIxMCBzZWMgZnJvbSBub3dcIlxyXG4gICAgLnNpZ24oZW5jb2RlZEtleSlcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlY3J5cHQoc2Vzc2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkID0gJycpOiBQcm9taXNlPGFueT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHBheWxvYWQgfSA9IGF3YWl0IGp3dFZlcmlmeShzZXNzaW9uLCBlbmNvZGVkS2V5LCB7IGFsZ29yaXRobXM6IFsnSFMyNTYnXSB9KVxyXG4gICAgcmV0dXJuIHBheWxvYWRcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5sb2coJ0ZhaWxlZCB0byB2ZXJpZnkgc2Vzc2lvbicpXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2Vzc2lvbih0b2tlbjogc3RyaW5nKSB7XHJcbiAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKVxyXG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBlbmNyeXB0KHsgdG9rZW4sIGV4cGlyZXNBdCB9KSAvLyBKU09OLnN0cmluZ2lmeSh0b2tlbilcclxuXHJcbiAgY29va2llcygpLnNldCgnc2Vzc2lvbicsIHNlc3Npb24sIHtcclxuICAgIGV4cGlyZXM6IGV4cGlyZXNBdCxcclxuICAgIG1heEFnZTogNjAgKiA2MCAqIDI0ICogNywgLy8gMSB3ZWVrXHJcbiAgICBwYXRoOiAnLycsXHJcbiAgICBkb21haW46IHByb2Nlc3MuZW52LkhPU1QgPz8gXCJsb2NhbGhvc3RcIixcclxuICAgIGh0dHBPbmx5OiB0cnVlLFxyXG4gICAgc2VjdXJlOiB0cnVlLCAvLyBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIsXHJcbiAgICBzYW1lU2l0ZTogJ2xheCcsXHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlc3Npb24oKSB7XHJcbiAgLy9jb25zdCBjb29raWUgPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KFwic2Vzc2lvblwiKT8udmFsdWVcclxuICBjb25zdCBjb29raWUgPSBjb29raWVzKCkuZ2V0KCdzZXNzaW9uJyk/LnZhbHVlXHJcbiAgaWYgKCFjb29raWUpIHJldHVybiBudWxsXHJcblxyXG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBkZWNyeXB0KGNvb2tpZSlcclxuICBpZiAoIXNlc3Npb24pIHJldHVybiBudWxsXHJcblxyXG4gIHJldHVybiBzZXNzaW9uXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVTZXNzaW9uKCkge1xyXG4gIC8vY29va2llcygpLnNldChcInNlc3Npb25cIiwgXCJcIiwgeyAuLi5jb25maWcsIG1heEFnZTogMCwgZXhwaXJlczogbmV3IERhdGUoMCkgfSk7XHJcbiAgY29va2llcygpLmRlbGV0ZSgnc2Vzc2lvbicpXHJcbn1cclxuXHJcbi8vIGV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlTZXNzaW9uKCkgeyAgLy8gZXhwb3J0IGNvbnN0IHZlcmlmeVNlc3Npb24gPSBjYWNoZShhc3luYyAoKSA9PiB7XHJcbi8vICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb24oKVxyXG4vLyAgIGlmICghc2Vzc2lvbiB8fCAhc2Vzc2lvbj8udG9rZW4pIHJldHVybiBudWxsIC8vIHJlZGlyZWN0KCcvbG9naW4nKVxyXG5cclxuLy8gICByZXR1cm4geyBpc0F1dGg6IHRydWUsIHRva2VuOiBzZXNzaW9uLnRva2VuIH1cclxuLy8gfSAvL30pXHJcblxyXG4vLyBleHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlclNlc3Npb24oKSB7IC8vZXhwb3J0IGNvbnN0IGdldFVzZXJTZXNzaW9uID0gY2FjaGUoYXN5bmMgKCkgPT4ge1xyXG4vLyAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCB2ZXJpZnlTZXNzaW9uKClcclxuLy8gICBpZiAoIXNlc3Npb24gfHwgIXNlc3Npb24/LnRva2VuKSByZXR1cm4gbnVsbFxyXG5cclxuLy8gICBjb25zdCB0b2tlbiA9IHNlc3Npb24/LnRva2VuXHJcbi8vICAgcmV0dXJuIGp3dERlY29kZSh0b2tlbilcclxuLy8gfSAvL30pXHJcbiJdLCJuYW1lcyI6WyJjb29raWVzIiwiU2lnbkpXVCIsImp3dFZlcmlmeSIsInNlY3JldEtleSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1NFU1NJT05fU0VDUkVUIiwiZW5jb2RlZEtleSIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwiZW5jcnlwdCIsInBheWxvYWQiLCJzZXRQcm90ZWN0ZWRIZWFkZXIiLCJhbGciLCJzZXRJc3N1ZWRBdCIsInNldEV4cGlyYXRpb25UaW1lIiwic2lnbiIsImRlY3J5cHQiLCJzZXNzaW9uIiwiYWxnb3JpdGhtcyIsImVycm9yIiwiY29uc29sZSIsImxvZyIsImNyZWF0ZVNlc3Npb24iLCJ0b2tlbiIsImV4cGlyZXNBdCIsIkRhdGUiLCJub3ciLCJzZXQiLCJleHBpcmVzIiwibWF4QWdlIiwicGF0aCIsImRvbWFpbiIsIkhPU1QiLCJodHRwT25seSIsInNlY3VyZSIsInNhbWVTaXRlIiwiZ2V0U2Vzc2lvbiIsImNvb2tpZSIsImdldCIsInZhbHVlIiwiZGVsZXRlU2Vzc2lvbiIsImRlbGV0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/lib/actions/session.ts\n");

/***/ })

});